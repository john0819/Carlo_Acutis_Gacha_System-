# å¿«é€Ÿå¯åŠ¨æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨æœ¬åœ°å’ŒæœåŠ¡å™¨ä¸Šå¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œé¡¹ç›®ã€‚

---

## ğŸ“ æœ¬åœ°å¼€å‘ç¯å¢ƒ

### å‰ç½®è¦æ±‚

- Go 1.19+
- Dockerï¼ˆç”¨äºè¿è¡ŒPostgreSQLæ•°æ®åº“ï¼‰
- ï¼ˆå¯é€‰ï¼‰ngrok æˆ– cloudflaredï¼ˆç”¨äºå…¬ç½‘è®¿é—®ï¼‰

### å¿«é€Ÿå¯åŠ¨æ­¥éª¤

#### 1. å¯åŠ¨æ•°æ®åº“

```bash
./start_db.sh
```

è¿™ä¼šå¯åŠ¨PostgreSQLæ•°æ®åº“å®¹å™¨ã€‚

#### 1.5. åˆå§‹åŒ–æ•°æ®åº“å’Œå¯¼å…¥å›¾ç‰‡ï¼ˆé¦–æ¬¡è¿è¡Œå¿…é¡»ï¼‰

```bash
# å¯¼å…¥å›¾ç‰‡åˆ°æ•°æ®åº“ï¼ˆå°†imagesç›®å½•ä¸‹çš„card*.pngå¯¼å…¥åˆ°æ•°æ®åº“ï¼‰
./scripts/init_local.sh
```

**é‡è¦ï¼š** é¦–æ¬¡è¿è¡Œæˆ–æ·»åŠ æ–°å›¾ç‰‡åï¼Œå¿…é¡»è¿è¡Œæ­¤è„šæœ¬å°†å›¾ç‰‡å¯¼å…¥æ•°æ®åº“ï¼Œå¦åˆ™æŠ½å¡æ—¶çœ‹ä¸åˆ°å›¾ç‰‡ã€‚

#### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**æ–¹å¼Aï¼šå¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼Œæ˜¾ç¤ºå®æ—¶æ—¥å¿—ï¼‰**
```bash
./dev.sh
```
- ç«¯å£ï¼š8080
- å‰å°è¿è¡Œï¼Œæ˜¾ç¤ºå®æ—¶æ—¥å¿—
- æŒ‰ `Ctrl+C` åœæ­¢

**æ–¹å¼Bï¼šåå°è¿è¡Œ**
```bash
# å¯åŠ¨æ•°æ®åº“
./start_db.sh

# åå°è¿è¡ŒæœåŠ¡å™¨
go run main.go > server.log 2>&1 &
```

#### 3. è®¿é—®åº”ç”¨

- ç™»å½•é¡µé¢ï¼šhttp://localhost:8080/login.html
- ä¸»é¡µï¼šhttp://localhost:8080/index.html
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8080/health

#### 4. åœæ­¢æœåŠ¡

```bash
./stop.sh
```

---

## ğŸŒ æœ¬åœ°å¼€å‘ + å…¬ç½‘è®¿é—®

å¦‚æœéœ€è¦è®©å…¶ä»–äººè®¿é—®ä½ çš„æœ¬åœ°æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ã€‚

### ğŸš€ ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

**ä¸€é”®å¯åŠ¨æœåŠ¡å™¨ + å†…ç½‘ç©¿é€ + è‡ªåŠ¨ç”ŸæˆäºŒç»´ç ï¼š**

```bash
# ä½¿ç”¨ ngrokï¼ˆé»˜è®¤ï¼‰
./start_with_tunnel.sh

# æˆ–ä½¿ç”¨ Cloudflare Tunnel
./start_with_tunnel.sh cloudflare
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… å¯åŠ¨æ•°æ®åº“
- âœ… å¯åŠ¨æœåŠ¡å™¨
- âœ… å¯åŠ¨å†…ç½‘ç©¿é€ï¼ˆngrok æˆ– Cloudflareï¼‰
- âœ… è·å–å…¬ç½‘åœ°å€
- âœ… è‡ªåŠ¨æ‰“å¼€äºŒç»´ç ç”Ÿæˆé¡µé¢

**ç”ŸæˆäºŒç»´ç ï¼š**
- è„šæœ¬ä¼šè‡ªåŠ¨æ‰“å¼€äºŒç»´ç ç”Ÿæˆé¡µé¢
- æˆ–è€…æ‰‹åŠ¨è®¿é—®ï¼š`http://å…¬ç½‘åœ°å€/qrcode.html`
- äºŒç»´ç é¡µé¢ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰å…¬ç½‘åœ°å€å¹¶ç”ŸæˆäºŒç»´ç 

---

### æ‰‹åŠ¨å¯åŠ¨ï¼ˆåˆ†æ­¥æ“ä½œï¼‰

#### æ–¹å¼1ï¼šä½¿ç”¨ ngrok

1. **å®‰è£… ngrok**
   ```bash
   # macOS
   brew install ngrok/ngrok/ngrok
   
   # é¦–æ¬¡ä½¿ç”¨éœ€è¦æ³¨å†Œå¹¶é…ç½®token
   # è®¿é—® https://dashboard.ngrok.com/signup
   ngrok config add-authtoken YOUR_TOKEN
   ```

2. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   ./start_db.sh
   ./dev.sh
   # åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œï¼š
   ```

3. **å¯åŠ¨ ngrok**
   ```bash
   ./start_ngrok.sh
   ```

4. **è·å–å…¬ç½‘åœ°å€å¹¶ç”ŸæˆäºŒç»´ç **
   - ngrok ä¼šæ˜¾ç¤ºä¸€ä¸ªå…¬ç½‘åœ°å€ï¼Œä¾‹å¦‚ï¼š`https://xxxx.ngrok.io`
   - è®¿é—®ï¼š`https://xxxx.ngrok.io/qrcode.html` ç”ŸæˆäºŒç»´ç 
   - äºŒç»´ç é¡µé¢ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰åœ°å€

#### æ–¹å¼2ï¼šä½¿ç”¨ Cloudflare Tunnel

1. **å®‰è£… cloudflared**
   ```bash
   brew install cloudflared
   ```

2. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   ./start_db.sh
   ./dev.sh
   # åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œï¼š
   ```

3. **å¯åŠ¨ Cloudflare Tunnel**
   ```bash
   ./start_cloudflare.sh
   ```

4. **è·å–å…¬ç½‘åœ°å€å¹¶ç”ŸæˆäºŒç»´ç **
   - Cloudflare ä¼šæ˜¾ç¤ºä¸€ä¸ªå…¬ç½‘åœ°å€
   - è®¿é—®ï¼š`å…¬ç½‘åœ°å€/qrcode.html` ç”ŸæˆäºŒç»´ç 

---

## ğŸ–¥ï¸ æœåŠ¡å™¨éƒ¨ç½²

### å‰ç½®è¦æ±‚

- æœåŠ¡å™¨å·²å®‰è£… Docker
- æœåŠ¡å™¨å·²å®‰è£… Goï¼ˆç”¨äºç¼–è¯‘ï¼‰
- ï¼ˆå¯é€‰ï¼‰å·²å®‰è£… Nginxï¼ˆç”¨äºåå‘ä»£ç†ï¼‰

### å¿«é€Ÿå¯åŠ¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰

é€‚åˆå¿«é€Ÿæµ‹è¯•ï¼Œä¸éœ€è¦Nginxå’ŒsystemdæœåŠ¡ã€‚

#### 1. é…ç½®SSHå¯†é’¥ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰

```bash
# åœ¨æœ¬åœ°è¿è¡Œ
./scripts/setup_ssh_key.sh æœåŠ¡å™¨IP ç”¨æˆ·å

# å¦‚æœè‡ªåŠ¨é…ç½®å¤±è´¥ï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºå…¬é’¥å†…å®¹
# æ‰‹åŠ¨å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨çš„ ~/.ssh/authorized_keys
```

#### 2. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

```bash
# ä½¿ç”¨gitå…‹éš†ï¼ˆæ¨èï¼‰
ssh admin@æœåŠ¡å™¨IP
cd /home/admin
git clone https://github.com/your-repo/h5project.git
cd h5project

# æˆ–è€…ä½¿ç”¨scpä¸Šä¼ ï¼ˆå¦‚æœä»£ç æœ‰ä¿®æ”¹ï¼‰
# åœ¨æœ¬åœ°è¿è¡Œï¼š
scp -r . admin@æœåŠ¡å™¨IP:/home/admin/h5project/
```

#### 3. ä¸Šä¼ å›¾ç‰‡ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# åœ¨æœ¬åœ°è¿è¡Œ
./scripts/upload_images.sh æœåŠ¡å™¨IP ç”¨æˆ·å
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“å’Œå¯¼å…¥å›¾ç‰‡ï¼ˆé¦–æ¬¡è¿è¡Œå¿…é¡»ï¼‰

```bash
# å¯¼å…¥å›¾ç‰‡åˆ°æ•°æ®åº“ï¼ˆå°†imagesç›®å½•ä¸‹çš„card*.pngå¯¼å…¥åˆ°æ•°æ®åº“ï¼‰
./scripts/init_server.sh
```

**é‡è¦ï¼š** é¦–æ¬¡è¿è¡Œæˆ–æ·»åŠ æ–°å›¾ç‰‡åï¼Œå¿…é¡»è¿è¡Œæ­¤è„šæœ¬å°†å›¾ç‰‡å¯¼å…¥æ•°æ®åº“ï¼Œå¦åˆ™æŠ½å¡æ—¶çœ‹ä¸åˆ°å›¾ç‰‡ã€‚

#### 5. å¿«é€Ÿå¯åŠ¨æœåŠ¡

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
cd /home/admin/h5project  # æˆ–ä½ çš„é¡¹ç›®ç›®å½•
./scripts/quick_start.sh
```

è¿™ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… å¯åŠ¨æ•°æ®åº“
- âœ… æ£€æŸ¥æ•°æ®åº“è¿æ¥
- âœ… åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
- âœ… ç¼–è¯‘Goç¨‹åº
- âœ… å¯åŠ¨æœåŠ¡ï¼ˆç«¯å£8080ï¼‰

#### 6. æµ‹è¯•è®¿é—®

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:8080/health

# æµ‹è¯•å›¾ç‰‡è®¿é—®
curl -I http://localhost:8080/images/card001.png

# ä»å¤–éƒ¨è®¿é—®ï¼ˆéœ€è¦å¼€æ”¾é˜²ç«å¢™ç«¯å£ï¼‰
# http://æœåŠ¡å™¨IP:8080
```

**å¦‚æœå›¾ç‰‡ä¸æ˜¾ç¤ºï¼š**
- è¿è¡Œ `./scripts/check_images.sh` æ£€æŸ¥é…ç½®
- ç¡®ä¿å·²è¿è¡Œ `./scripts/init_server.sh` å¯¼å…¥å›¾ç‰‡

---

### å®Œæ•´éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

é€‚åˆæ­£å¼éƒ¨ç½²ï¼ŒåŒ…æ‹¬Nginxåå‘ä»£ç†å’ŒsystemdæœåŠ¡ã€‚

#### 1. è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
cd /home/admin/h5project
./deploy/deploy.sh
```

è¿™ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… ç¼–è¯‘Goç¨‹åº
- âœ… åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆ/opt/h5projectï¼‰
- âœ… é…ç½®systemdæœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰
- âœ… é…ç½®Nginxåå‘ä»£ç†
- âœ… å¯åŠ¨æ•°æ®åº“
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… å¯åŠ¨æœåŠ¡

#### 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥GoæœåŠ¡
sudo systemctl status h5project

# æ£€æŸ¥Nginx
sudo systemctl status nginx

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u h5project -f
```

#### 3. å¼€æ”¾é˜²ç«å¢™ç«¯å£

```bash
# å¼€æ”¾80ç«¯å£ï¼ˆHTTPï¼‰
firewall-cmd --permanent --add-service=http
firewall-cmd --reload

# æˆ–ä½¿ç”¨iptables
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
```

#### 4. è®¿é—®åº”ç”¨

- http://æœåŠ¡å™¨IP/
- http://ä½ çš„åŸŸå/ï¼ˆå¦‚æœé…ç½®äº†åŸŸåï¼‰

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨æ•°æ®åº“
./start_db.sh

# å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆæ˜¾ç¤ºæ—¥å¿—ï¼‰
./dev.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f server.log
```

### æœåŠ¡å™¨ç®¡ç†

```bash
# å¿«é€Ÿå¯åŠ¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
./scripts/quick_start.sh

# å¯åŠ¨æ•°æ®åº“
./scripts/start_db_server.sh

# åˆå§‹åŒ–æ•°æ®åº“å’Œå¯¼å…¥å›¾ç‰‡
./scripts/init_server.sh

# å®Œæ•´éƒ¨ç½²
./deploy/deploy.sh

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status h5project

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u h5project -f

# é‡å¯æœåŠ¡
sudo systemctl restart h5project
```

---

## â“ å¸¸è§é—®é¢˜

### å›¾ç‰‡ä¸æ˜¾ç¤º

**é—®é¢˜ï¼š** æŠ½å¡æ—¶çœ‹ä¸åˆ°å›¾ç‰‡ï¼Œæˆ–è€…å›¾ç‰‡åŠ è½½å¤±è´¥

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å·²å¯¼å…¥æ•°æ®åº“**
   ```bash
   ./scripts/check_images.sh
   ```

2. **å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰å¡ç‰‡æ•°æ®ï¼Œè¿è¡Œåˆå§‹åŒ–è„šæœ¬**
   ```bash
   # æœ¬åœ°å¼€å‘
   ./scripts/init_local.sh
   
   # æœåŠ¡å™¨
   ./scripts/init_server.sh
   ```

3. **æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨**
   ```bash
   ls -la images/card*.png
   ```

4. **æ£€æŸ¥å›¾ç‰‡è·¯å¾„æ ¼å¼**
   - æ•°æ®åº“ä¸­çš„ `image_url` åº”è¯¥æ˜¯ï¼š`/images/card001.png`
   - å‰ç«¯è®¿é—®è·¯å¾„ï¼š`http://localhost:8080/images/card001.png`

5. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**
   - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
   - æŸ¥çœ‹ Console å’Œ Network æ ‡ç­¾
   - æ£€æŸ¥å›¾ç‰‡è¯·æ±‚æ˜¯å¦è¿”å› 404 æˆ–å…¶ä»–é”™è¯¯

6. **æµ‹è¯•å›¾ç‰‡ç›´æ¥è®¿é—®**
   ```bash
   # åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®
   http://localhost:8080/images/card001.png
   ```

**å¸¸è§åŸå› ï¼š**
- âŒ æ•°æ®åº“ä¸­æ²¡æœ‰å¡ç‰‡æ•°æ®ï¼ˆæœ€å¸¸è§ï¼‰
- âŒ å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨
- âŒ å›¾ç‰‡è·¯å¾„æ ¼å¼é”™è¯¯
- âŒ æœåŠ¡å™¨æœªæ­£ç¡®é…ç½®é™æ€æ–‡ä»¶æœåŠ¡

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥Dockerå®¹å™¨æ˜¯å¦è¿è¡Œ
docker ps | grep h5project_db

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs h5project_db

# é‡å¯æ•°æ®åº“
docker-compose -f deploy/docker-compose.prod.yml restart
```

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹å ç”¨8080ç«¯å£çš„è¿›ç¨‹
lsof -i :8080

# åœæ­¢è¿›ç¨‹
kill -9 PID
```

### æœåŠ¡å™¨ä¸Šdocker-composeå‘½ä»¤æ‰¾ä¸åˆ°

æ–°ç‰ˆæœ¬Dockerä½¿ç”¨ `docker compose`ï¼ˆæ— è¿å­—ç¬¦ï¼‰ï¼š
```bash
# æ£€æŸ¥ç‰ˆæœ¬
docker compose version

# ä½¿ç”¨æ–°å‘½ä»¤
docker compose -f deploy/docker-compose.prod.yml up -d
```

å¦‚æœéƒ½æ²¡æœ‰ï¼Œå®‰è£…docker-composeï¼š
```bash
yum install -y docker-compose
```

### ä¸Šä¼ å›¾ç‰‡é€Ÿåº¦æ…¢

è„šæœ¬å·²è‡ªåŠ¨ä½¿ç”¨ `rsync`ï¼ˆæ¯”scpæ›´å¿«ï¼‰ï¼š
```bash
./scripts/upload_images.sh æœåŠ¡å™¨IP ç”¨æˆ·å
```

å¦‚æœè¿˜æ˜¯æ…¢ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥ï¼š
- ä½¿ç”¨å‹ç¼©ä¼ è¾“ï¼ˆå·²è‡ªåŠ¨å¯ç”¨ï¼‰
- åˆ†æ‰¹ä¸Šä¼ 
- ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½å›¾ç‰‡

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

### ä¿ç•™çš„è„šæœ¬æ–‡ä»¶

**æœ¬åœ°å¼€å‘ï¼š**
- `start_db.sh` - å¯åŠ¨æ•°æ®åº“
- `dev.sh` - å¼€å‘æ¨¡å¼å¯åŠ¨
- `stop.sh` - åœæ­¢æœåŠ¡
- `start_with_tunnel.sh` - **ä¸€é”®å¯åŠ¨ï¼ˆæ•°æ®åº“+æœåŠ¡å™¨+å†…ç½‘ç©¿é€+äºŒç»´ç ï¼‰** â­æ¨è
- `start_ngrok.sh` - ngrokå†…ç½‘ç©¿é€ï¼ˆå•ç‹¬ä½¿ç”¨ï¼‰
- `start_cloudflare.sh` - Cloudflareå†…ç½‘ç©¿é€ï¼ˆå•ç‹¬ä½¿ç”¨ï¼‰

**æœåŠ¡å™¨éƒ¨ç½²ï¼š**
- `deploy/deploy.sh` - å®Œæ•´éƒ¨ç½²è„šæœ¬
- `scripts/quick_start.sh` - å¿«é€Ÿå¯åŠ¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
- `scripts/start_db_server.sh` - å¯åŠ¨æ•°æ®åº“
- `scripts/init_server.sh` - åˆå§‹åŒ–æœåŠ¡å™¨
- `scripts/upload_images.sh` - ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨
- `scripts/setup_ssh_key.sh` - é…ç½®SSHå¯†é’¥

---

## ğŸš€ å¿«é€Ÿå‚è€ƒ

### æœ¬åœ°å¼€å‘
```bash
./start_db.sh && ./dev.sh
```

### æœ¬åœ° + å…¬ç½‘è®¿é—® + äºŒç»´ç ï¼ˆä¸€é”®å¯åŠ¨ï¼‰â­æ¨è
```bash
./start_with_tunnel.sh
# æˆ–æŒ‡å®šå†…ç½‘ç©¿é€ç±»å‹
./start_with_tunnel.sh ngrok      # ä½¿ç”¨ngrok
./start_with_tunnel.sh cloudflare  # ä½¿ç”¨Cloudflare
```

### æœ¬åœ° + å…¬ç½‘è®¿é—®ï¼ˆæ‰‹åŠ¨åˆ†æ­¥ï¼‰
```bash
# ç»ˆç«¯1
./start_db.sh && ./dev.sh

# ç»ˆç«¯2
./start_ngrok.sh  # æˆ– ./start_cloudflare.sh

# ç„¶åè®¿é—®: å…¬ç½‘åœ°å€/qrcode.html ç”ŸæˆäºŒç»´ç 
```

### æœåŠ¡å™¨å¿«é€Ÿæµ‹è¯•
```bash
./scripts/quick_start.sh
```

### æœåŠ¡å™¨å®Œæ•´éƒ¨ç½²
```bash
./deploy/deploy.sh
```

